<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: game.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: game.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { canvas, context } from "./canvas";
import { GameObject } from "./objects/index";
import { mix } from './interaction/index';

/** @module Game */

/**
 * @typedef {object} GameConfig
 * @property {any} initLevel - Function used to init the level. Called when a new level is requested
 * @property {object[]} puzzles - Array of puzzles to be used
 */

/**
 * @class
 * @constructor
 * @public
 */
export class Game {
    /**
     * @type {GameObject[]}
     * @public
     */
    objects = [];

    /**
     * @type {object[]}
     * @public
     */
    puzzles;

    /**
     * @type {object}
     * @public
     */
    currentPuzzle;

    /**
     * @type {number}
     */
    _puzzleIndex = 0;

    /**
     * @param {GameConfig} o 
     */
    constructor(o) {
        this.puzzles = o.puzzles;
        this.currentPuzzle = o.puzzles[0];
        this._loop();

        // Shortcut to next level
        document.addEventListener('keydown', (e) => e.key === 'n' &amp;&amp; this.nextLevel());
    }

    add(config) {
        class _ extends mix(config.impl).with(...config.interactions || []) { };
        const _c = new _(this, config.options, config.name);
        _c.init();
        this.objects.push(_c);
    }

    /**
     * Initialised the game by calling initLevel.
     */
    _init() {
        this.objects.forEach((o) => o &amp;&amp; o.init &amp;&amp; o.init());
        this._printSummary();
    }

    /**
     * Clears the canvas
     */

    _clear() {
        context.clearRect(0, 0, canvas.width, canvas.height);
    }

    /**
     * Loops over all GameObjects and calls draw()
     */
    
    _draw() {
        for (let o of this.objects) {
            o.draw();
        }
    }

    /**
     * Main game loop
     */
    _loop() {
        this._clear();
        this._draw();
        window.requestAnimationFrame(this._loop.bind(this));
    }

    /**
     * Increments the level and inits with the next set of puzzles. Calls gameOver if no more puzzles are left
     */
    nextLevel() {
        this._puzzleIndex++;
        this.currentPuzzle = this.puzzles[this._puzzleIndex];
        if (this.currentPuzzle) {
            this._init();
        } else {
            this._destroyObjects();
        }
    }

    /**
     * Destroys objects
     */
    _destroyObjects() {
        for (let o of this.objects) {
            o.destroy();
        }
    }

    /**
     * Prints a summary of the level to the console
     */
    _printSummary() {
        console.table({
            'canvas': `${canvas.width}x${canvas.height}`,
            'grid': `${this.currentPuzzle.board.length}x${this.currentPuzzle.board[0].length}`,
            'block': `${canvas.width / this.currentPuzzle.board.length}x${canvas.height / this.currentPuzzle.board[0].length}`,
        });
    }
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-Game.html">Game</a></li><li><a href="module-Lib.html">Lib</a></li><li><a href="module-Lib_animation.html">Lib/animation</a></li><li><a href="module-Lib_interaction.html">Lib/interaction</a></li><li><a href="module-Lib_objects.html">Lib/objects</a></li><li><a href="module-Lib_utils.html">Lib/utils</a></li></ul><h3>Classes</h3><ul><li><a href="module-Game.Game.html">Game</a></li><li><a href="module-Lib_interaction-MixinBuilder.html">MixinBuilder</a></li><li><a href="module-Lib_objects.GameObject.html">GameObject</a></li><li><a href="module-Lib_objects.ImageGameObject.html">ImageGameObject</a></li></ul><h3>Global</h3><ul><li><a href="global.html#ArrowMovementMixin">ArrowMovementMixin</a></li><li><a href="global.html#canvas">canvas</a></li><li><a href="global.html#context">context</a></li><li><a href="global.html#EnterKeyMixin">EnterKeyMixin</a></li><li><a href="global.html#OnClickMixin">OnClickMixin</a></li><li><a href="global.html#WASDMovementMixin">WASDMovementMixin</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Mon Dec 06 2021 17:47:28 GMT+1000 (Australian Eastern Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
